<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem Code</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css">
    <style>
        :root {
            --bg-deep-space: #0a0a0f;
            --bg-cosmic: #151520;
            --bg-stellar: #1e1e2d;
            --bg-nebula: #252536;
            --neon-purple: #8b5cf6;
            --neon-violet: #a855f7;
            --neon-fuchsia: #d946ef;
            --neon-cyan: #06b6d4;
            --gradient-primary: linear-gradient(135deg, #8b5cf6, #d946ef);
            --text-stellar: #ffffff;
            --text-milky: #e2e8f0;
            --text-dust: #94a3b8;
            --success-emerald: #10b981;
            --warning-amber: #f59e0b;
            --error-crimson: #ef4444;
            --info-sapphire: #3b82f6;
            --glow-primary: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-deep-space);
            color: var(--text-milky);
            overflow: hidden;
        }

        .language-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(10, 10, 15, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .modal-header h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .language-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            max-width: 800px;
            width: 100%;
        }

        .language-card {
            background: transparent;
            border-radius: 12px;
            padding: 2rem 1rem;
            text-align: center;
            cursor: pointer;
            border: 2px solid var(--neon-purple);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .language-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--glow-primary);
            background: rgba(139, 92, 246, 0.1);
        }

        .language-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--neon-purple);
        }

        .language-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .main-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            opacity: 0;
        }

        .app-header {
            background-color: var(--bg-cosmic);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--bg-nebula);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .language-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-stellar);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--neon-purple);
        }

        .header-controls {
            display: flex;
            gap: 1rem;
        }

        .btn-change-language {
            background: var(--bg-stellar);
            border: 1px solid var(--neon-purple);
            color: var(--text-milky);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-change-language:hover {
            background: var(--neon-purple);
        }

        .editor-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .code-editor-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-stellar);
        }

        .editor-header {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 1rem;
            background-color: var(--bg-cosmic);
            border-bottom: 1px solid var(--bg-nebula);
        }

        #code-editor {
            flex: 1;
            overflow: hidden;
        }

        .CodeMirror {
            height: 100%;
            font-size: 14px;
            line-height: 1.5;
        }

        .error-panel {
            width: 400px;
            background-color: var(--bg-cosmic);
            border-left: 1px solid var(--bg-nebula);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            padding: 1rem;
            background-color: var(--bg-stellar);
            border-bottom: 1px solid var(--bg-nebula);
        }

        .panel-header h3 {
            margin-bottom: 0.5rem;
        }

        .error-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
        }

        .error-count {
            color: var(--error-crimson);
        }

        .warning-count {
            color: var(--warning-amber);
        }

        .suggestion-count {
            color: var(--info-sapphire);
        }

        .error-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .error-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 6px;
            background-color: var(--bg-stellar);
            border-left: 4px solid var(--error-crimson);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .error-item:hover {
            transform: translateX(5px);
        }

        .error-item.warning {
            border-left-color: var(--warning-amber);
        }

        .error-item.suggestion {
            border-left-color: var(--info-sapphire);
        }

        .error-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .error-icon {
            font-size: 1.2rem;
        }

        .error-title {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .error-description {
            font-size: 0.85rem;
            color: var(--text-dust);
            margin-bottom: 0.25rem;
        }

        .error-location {
            font-size: 0.8rem;
            color: var(--text-dust);
        }

        .check-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--glow-primary);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .check-button:hover {
            transform: scale(1.05);
        }

        .language-suggestion {
            background: var(--bg-nebula);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 6px;
            border-left: 4px solid var(--neon-cyan);
        }

        .language-suggestion h4 {
            color: var(--neon-cyan);
            margin-bottom: 0.5rem;
        }

        .suggested-languages {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .suggested-language {
            background: var(--bg-stellar);
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid var(--neon-cyan);
            transition: all 0.2s ease;
        }

        .suggested-language:hover {
            background: var(--neon-cyan);
            color: white;
        }

        .analysis-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem 1rem;
            background: var(--bg-stellar);
            border-radius: 8px;
        }

        .progress-bar {
            width: 100px;
            height: 4px;
            background: var(--bg-nebula);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- –ù–∞—á–∞–ª—å–Ω–æ–µ –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ -->
    <div class="language-modal" id="language-modal">
        <div class="modal-header">
            <h2>Problem Code</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</p>
        </div>
        <div class="language-grid">
            <div class="language-card" data-lang="python">
                <div class="language-icon">Py</div>
                <div class="language-name">Python</div>
            </div>
            <div class="language-card" data-lang="javascript">
                <div class="language-icon">JS</div>
                <div class="language-name">JavaScript</div>
            </div>
            <div class="language-card" data-lang="html">
                <div class="language-icon">H5</div>
                <div class="language-name">HTML</div>
            </div>
            <div class="language-card" data-lang="css">
                <div class="language-icon">CS</div>
                <div class="language-name">CSS</div>
            </div>
            <div class="language-card" data-lang="cpp">
                <div class="language-icon">C+</div>
                <div class="language-name">C++</div>
            </div>
            <div class="language-card" data-lang="java">
                <div class="language-icon">Jv</div>
                <div class="language-name">Java</div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <div class="main-container" id="main-container">
        <header class="app-header">
            <div class="logo">Problem Code</div>
            <div class="language-indicator">
                <span class="current-language" id="current-language">Python</span>
            </div>
            <div class="header-controls">
                <button class="btn-change-language" id="change-language">–°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫</button>
            </div>
        </header>
        
        <main class="editor-container">
            <div class="code-editor-wrapper">
                <div class="editor-header">
                    <div class="analysis-progress" id="analysis-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                        </div>
                        <span>–ê–Ω–∞–ª–∏–∑...</span>
                    </div>
                </div>
                <div id="code-editor"></div>
            </div>
            
            <div class="error-panel">
                <div class="panel-header">
                    <h3>–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞</h3>
                    <div class="error-stats">
                        <span class="error-count" id="error-count">0 –æ—à–∏–±–æ–∫</span>
                        <span class="warning-count" id="warning-count">0 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π</span>
                        <span class="suggestion-count" id="suggestion-count">0 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</span>
                    </div>
                </div>
                <div class="error-list" id="error-list"></div>
            </div>
        </main>
        
        <button class="check-button" id="check-code">
            <span class="check-icon">üîç</span>
            –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥
        </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —è–∑—ã–∫–æ–≤
        const languages = {
            python: {
                id: 'python',
                name: 'Python',
                syntax: 'python',
                template: 'def main():\n    print("Hello, World!")\n\nif __name__ == "__main__":\n    main()',
                keywords: ['def ', 'class ', 'import ', 'from ', 'as ', 'if ', 'elif ', 'else:', 'for ', 'while ', 'try:', 'except ', 'with ', 'lambda ', 'print(', 'range(', 'len(', '__name__'],
                patterns: [/^def\s+\w+/, /^class\s+\w+/, /import\s+\w+/, /from\s+\w+/, /print\(/, /__\w+__/]
            },
            javascript: {
                id: 'javascript',
                name: 'JavaScript', 
                syntax: 'javascript',
                template: 'function main() {\n    console.log("Hello, World!");\n}\n\nmain();',
                keywords: ['function', 'const ', 'let ', 'var ', 'if (', 'else {', 'for (', 'while (', 'console.log', 'return ', '=>', 'document.', 'window.'],
                patterns: [/function\s*\w*\s*\(/, /const\s+\w+\s*=/, /let\s+\w+\s*=/, /console\.log/, /=>/, /document\./, /window\./]
            },
            html: {
                id: 'html',
                name: 'HTML',
                syntax: 'html',
                template: '<!DOCTYPE html>\n<html>\n<head>\n    <title>Document</title>\n</head>\n<body>\n    <h1>Hello, World!</h1>\n</body>\n</html>',
                keywords: ['<!DOCTYPE', '<html', '<head', '<body', '<div', '<span', '<h1', '<p', 'class=', 'id=', '<script', '<style'],
                patterns: [/<\!DOCTYPE html>/, /<html[\s>]/, /<head[\s>]/, /<body[\s>]/, /<[\w]+\s*[^>]*>/, /class=/, /id=/]
            },
            css: {
                id: 'css',
                name: 'CSS',
                syntax: 'css', 
                template: 'body {\n    margin: 0;\n    padding: 0;\n    font-family: Arial, sans-serif;\n}',
                keywords: ['{', '}', ':', ';', 'margin', 'padding', 'font-family', 'color', 'background', 'width', 'height', '@media'],
                patterns: [/\w+\s*\{/, /:\s*[^;]+;/, /@media/, /\.\w+/, /#\w+/]
            },
            cpp: {
                id: 'cpp',
                name: 'C++',
                syntax: 'text/x-c++src',
                template: '#include <iostream>\n\nint main() {\n    std::cout << "Hello, World!" << std::endl;\n    return 0;\n}',
                keywords: ['#include', 'using namespace', 'int main()', 'std::cout', 'std::endl', 'return ', '<<'],
                patterns: [/#include\s*[<"][^>"]+[>"]/, /using\s+namespace\s+std/, /int\s+main\s*\(\)/, /std::\w+/]
            },
            java: {
                id: 'java',
                name: 'Java',
                syntax: 'text/x-java',
                template: 'public class Main {\n    public static void main(String[] args) {\n        System.out.println("Hello, World!");\n    }\n}',
                keywords: ['public class', 'public static void main', 'System.out.println', 'String[] args'],
                patterns: [/public\s+class\s+\w+/, /public\s+static\s+void\s+main\s*\(/, /System\.out\.println/]
            }
        };

        let currentLanguage = null;
        let editor = null;
        let errorMarkers = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            initializeLanguageSelector();
            // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –º–µ–Ω—é
            showLanguageModal();
        }

        function initializeLanguageSelector() {
            const languageCards = document.querySelectorAll('.language-card');
            languageCards.forEach(card => {
                card.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    selectLanguage(lang);
                });
            });

            document.getElementById('change-language').addEventListener('click', function() {
                showLanguageModal();
            });

            document.getElementById('check-code').addEventListener('click', analyzeCode);
        }

        function showLanguageModal() {
            document.getElementById('language-modal').style.display = 'flex';
            document.getElementById('main-container').style.opacity = '0';
        }

        function selectLanguage(lang) {
            currentLanguage = languages[lang];
            document.getElementById('current-language').textContent = currentLanguage.name;
            document.getElementById('language-modal').style.display = 'none';
            document.getElementById('main-container').style.opacity = '1';
            
            initializeEditor();
        }

        function initializeEditor() {
            const editorElement = document.getElementById('code-editor');
            
            if (editor) {
                editor.toTextArea();
            }
            
            editor = CodeMirror(editorElement, {
                value: currentLanguage.template,
                mode: currentLanguage.syntax,
                lineNumbers: true,
                matchBrackets: true,
                autoCloseBrackets: true,
                indentUnit: 4,
                theme: 'monokai',
                lineWrapping: true
            });
        }

        // –†–ï–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó–ê–¢–û–† –ö–û–î–ê
        class RealCodeAnalyzer {
            async analyzeCode(code, language) {
                const results = {
                    errors: [],
                    warnings: [],
                    suggestions: [],
                    languageMismatches: [],
                    score: 100
                };

                try {
                    // –ê–Ω–∞–ª–∏–∑ —è–∑—ã–∫–∞
                    const languageResults = this.languageDetectionAnalysis(code, language);
                    results.languageMismatches.push(...languageResults.languageMismatches);

                    // –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
                    const syntaxResults = this.syntaxAnalysis(code, language);
                    results.errors.push(...syntaxResults.errors);
                    results.warnings.push(...syntaxResults.warnings);

                    // –°—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
                    const styleResults = this.styleAnalysis(code, language);
                    results.warnings.push(...styleResults.warnings);
                    results.suggestions.push(...styleResults.suggestions);

                    // –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                    const securityResults = this.securityAnalysis(code, language);
                    results.warnings.push(...securityResults.warnings);

                    // Best practices
                    const practiceResults = this.bestPracticesAnalysis(code, language);
                    results.suggestions.push(...practiceResults.suggestions);

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:', error);
                }

                // –†–∞—Å—á–µ—Ç –æ—Ü–µ–Ω–∫–∏
                results.score = this.calculateScore(results);
                return results;
            }

            languageDetectionAnalysis(code, currentLang) {
                const languageMismatches = [];
                const detectedLanguages = this.detectLanguage(code);
                
                if (detectedLanguages.length > 0) {
                    const bestMatch = detectedLanguages[0];
                    if (bestMatch.id !== currentLang.id) {
                        languageMismatches.push({
                            type: 'LANGUAGE_MISMATCH',
                            message: `–ö–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —è–∑—ã–∫–∞ ${bestMatch.name}`,
                            suggestedLanguages: detectedLanguages.slice(0, 2),
                            line: 1,
                            column: 1
                        });
                    }
                }

                return { languageMismatches };
            }

            detectLanguage(code) {
                const scores = {};
                
                Object.values(languages).forEach(lang => {
                    let score = 0;
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                    lang.keywords.forEach(keyword => {
                        const count = (code.match(new RegExp(keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi')) || []).length;
                        score += count * 2;
                    });
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
                    lang.patterns.forEach(pattern => {
                        const count = (code.match(pattern) || []).length;
                        score += count * 3;
                    });
                    scores[lang.id] = score;
                });
                
                return Object.entries(scores)
                    .filter(([_, score]) => score > 0)
                    .sort(([,a], [,b]) => b - a)
                    .map(([langId]) => languages[langId]);
            }

            syntaxAnalysis(code, language) {
                const errors = [];
                const warnings = [];
                const lines = code.split('\n');

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ —Å–∫–æ–±–æ–∫
                const stack = [];
                const brackets = { '(': ')', '[': ']', '{': '}' };

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    for (let j = 0; j < line.length; j++) {
                        const char = line[j];
                        if (brackets[char]) {
                            stack.push({ char, line: i + 1, col: j + 1 });
                        } else if (Object.values(brackets).includes(char)) {
                            if (stack.length === 0) {
                                errors.push({
                                    type: 'SYNTAX_ERROR',
                                    message: `–õ–∏—à–Ω—è—è –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ '${char}'`,
                                    line: i + 1,
                                    column: j + 1
                                });
                            } else {
                                const last = stack.pop();
                                if (brackets[last.char] !== char) {
                                    errors.push({
                                        type: 'SYNTAX_ERROR',
                                        message: `–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–∫–æ–±–æ–∫: –æ–∂–∏–¥–∞–ª–æ—Å—å '${brackets[last.char]}'`,
                                        line: i + 1,
                                        column: j + 1
                                    });
                                }
                            }
                        }
                    }
                }

                // –ù–µ–∑–∞–∫—Ä—ã—Ç—ã–µ —Å–∫–æ–±–∫–∏
                stack.forEach(({ char, line, col }) => {
                    errors.push({
                        type: 'SYNTAX_ERROR',
                        message: `–ù–µ–∑–∞–∫—Ä—ã—Ç–∞—è —Å–∫–æ–±–∫–∞ '${char}'`,
                        line: line,
                        column: col
                    });
                });

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–≤—ã—á–µ–∫
                let inString = false;
                let quoteChar = '';
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    for (let j = 0; j < line.length; j++) {
                        const char = line[j];
                        if ((char === '"' || char === "'") && (j === 0 || line[j-1] !== '\\')) {
                            if (!inString) {
                                inString = true;
                                quoteChar = char;
                            } else if (char === quoteChar) {
                                inString = false;
                            }
                        }
                    }
                }

                if (inString) {
                    warnings.push({
                        type: 'SYNTAX_WARNING',
                        message: '–í–æ–∑–º–æ–∂–Ω–æ –Ω–µ–∑–∞–∫—Ä—ã—Ç–∞—è —Å—Ç—Ä–æ–∫–∞',
                        line: 1,
                        column: 1
                    });
                }

                return { errors, warnings };
            }

            styleAnalysis(code, language) {
                const warnings = [];
                const suggestions = [];
                const lines = code.split('\n');

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫
                lines.forEach((line, index) => {
                    if (line.length > 120) {
                        warnings.push({
                            type: 'STYLE_WARNING',
                            message: `–°—Ç—Ä–æ–∫–∞ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–∞—è (${line.length} —Å–∏–º–≤–æ–ª–æ–≤)`,
                            line: index + 1,
                            column: 120
                        });
                    }
                });

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—Ç—É–ø–æ–≤ –¥–ª—è Python
                if (language.id === 'python') {
                    let expectedIndent = 0;
                    lines.forEach((line, index) => {
                        if (line.trim() === '') return;
                        
                        const currentIndent = line.search(/\S/);
                        if (currentIndent % 4 !== 0 && currentIndent > 0) {
                            warnings.push({
                                type: 'STYLE_WARNING',
                                message: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç—Å—Ç—É–ø (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫—Ä–∞—Ç–µ–Ω 4)',
                                line: index + 1,
                                column: 1
                            });
                        }
                    });
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±—É–ª—è—Ü–∏–∏
                if (code.includes('\t')) {
                    suggestions.push({
                        type: 'STYLE_SUGGESTION',
                        message: '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã –≤–º–µ—Å—Ç–æ —Ç–∞–±—É–ª—è—Ü–∏–∏',
                        line: 1,
                        column: 1
                    });
                }

                return { warnings, suggestions };
            }

            securityAnalysis(code, language) {
                const warnings = [];

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
                const dangerous = [
                    { pattern: /eval\(/, message: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ eval() –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø–∞—Å–Ω—ã–º' },
                    { pattern: /exec\(/, message: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ exec() –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø–∞—Å–Ω—ã–º' },
                    { pattern: /innerHTML\s*=/, message: '–ü—Ä—è–º–æ–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ innerHTML –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ XSS' }
                ];

                dangerous.forEach(({ pattern, message }) => {
                    if (pattern.test(code)) {
                        warnings.push({
                            type: 'SECURITY_WARNING',
                            message: message,
                            line: 1,
                            column: 1
                        });
                    }
                });

                return { warnings };
            }

            bestPracticesAnalysis(code, language) {
                const suggestions = [];

                if (language.id === 'python') {
                    if (code.includes('print(') && !code.includes('__name__')) {
                        suggestions.push({
                            type: 'BEST_PRACTICE',
                            message: '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å if __name__ == "__main__"',
                            line: 1,
                            column: 1
                        });
                    }
                }

                if (language.id === 'javascript') {
                    if (code.includes(' == ') && !code.includes(' === ')) {
                        suggestions.push({
                            type: 'BEST_PRACTICE',
                            message: '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å === –≤–º–µ—Å—Ç–æ ==',
                            line: 1,
                            column: 1
                        });
                    }
                }

                return { suggestions };
            }

            calculateScore(results) {
                let score = 100;
                score -= results.errors.length * 10;
                score -= results.warnings.length * 3;
                score -= results.languageMismatches.length * 5;
                return Math.max(0, score);
            }
        }

        async function analyzeCode() {
            if (!editor || !currentLanguage) return;

            const code = editor.getValue();
            const analyzer = new RealCodeAnalyzer();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const progress = document.getElementById('analysis-progress');
            const progressFill = document.getElementById('progress-fill');
            progress.style.display = 'flex';
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            for (let i = 0; i <= 100; i += 10) {
                progressFill.style.width = i + '%';
                await new Promise(resolve => setTimeout(resolve, 50));
            }

            try {
                const results = await analyzer.analyzeCode(code, currentLanguage);
                displayAnalysisResults(results);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:', error);
            } finally {
                setTimeout(() => {
                    progress.style.display = 'none';
                }, 500);
            }
        }

        function displayAnalysisResults(results) {
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—à–∏–±–∫–∏
            if (errorMarkers) {
                errorMarkers.forEach(marker => marker.clear());
            }
            errorMarkers = [];

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('error-count').textContent = `${results.errors.length} –æ—à–∏–±–æ–∫`;
            document.getElementById('warning-count').textContent = `${results.warnings.length} –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π`;
            document.getElementById('suggestion-count').textContent = `${results.suggestions.length} –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π`;

            const errorList = document.getElementById('error-list');
            errorList.innerHTML = '';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —è–∑—ã–∫–∞
            if (results.languageMismatches.length > 0) {
                const mismatch = results.languageMismatches[0];
                const suggestionDiv = document.createElement('div');
                suggestionDiv.className = 'language-suggestion';
                
                let languagesHTML = '';
                mismatch.suggestedLanguages.forEach(lang => {
                    languagesHTML += `<div class="suggested-language" data-lang="${lang.id}">${lang.name}</div>`;
                });
                
                suggestionDiv.innerHTML = `
                    <h4>üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —è–∑—ã–∫–∞</h4>
                    <div class="error-description">${mismatch.message}</div>
                    <div class="suggested-languages">${languagesHTML}</div>
                `;
                
                errorList.appendChild(suggestionDiv);

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
                suggestionDiv.querySelectorAll('.suggested-language').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const lang = this.getAttribute('data-lang');
                        selectLanguage(lang);
                    });
                });
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –æ—à–∏–±–∫–∏
            results.errors.forEach(error => {
                addIssueToPanel(error, 'error');
                markErrorInEditor(error);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
            results.warnings.forEach(warning => {
                addIssueToPanel(warning, 'warning');
                markErrorInEditor(warning);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
            results.suggestions.forEach(suggestion => {
                addIssueToPanel(suggestion, 'suggestion');
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—â—É—é –æ—Ü–µ–Ω–∫—É
            if (results.errors.length === 0 && results.warnings.length === 0) {
                const successItem = document.createElement('div');
                successItem.className = 'error-item';
                successItem.style.borderLeftColor = 'var(--success-emerald)';
                successItem.innerHTML = `
                    <div class="error-header">
                        <span class="error-icon">‚úÖ</span>
                        <span class="error-title">–ö–æ–¥ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ!</span>
                    </div>
                    <div class="error-description">–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞: ${results.score}/100</div>
                `;
                errorList.appendChild(successItem);
            }
        }

        function addIssueToPanel(issue, type) {
            const errorList = document.getElementById('error-list');
            const item = document.createElement('div');
            item.className = `error-item ${type}`;

            const icons = {
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è',
                'suggestion': 'üí°'
            };

            item.innerHTML = `
                <div class="error-header">
                    <span class="error-icon">${icons[type]}</span>
                    <span class="error-title">${issue.message}</span>
                </div>
                <div class="error-location">–°—Ç—Ä–æ–∫–∞ ${issue.line}, —Å—Ç–æ–ª–±–µ—Ü ${issue.column}</div>
            `;

            if (issue.line) {
                item.addEventListener('click', () => {
                    editor.setCursor({ line: issue.line - 1, ch: issue.column - 1 });
                    editor.focus();
                });
            }

            errorList.appendChild(item);
        }

        function markErrorInEditor(issue) {
            if (!issue.line) return;
            
            try {
                const line = issue.line - 1;
                const from = { line: line, ch: Math.max(0, (issue.column || 1) - 1) };
                const to = { line: line, ch: Math.max(1, (issue.column || 1)) };
                
                const markerClass = issue.type.includes('ERROR') ? 'error-marker' : 
                                  issue.type.includes('WARNING') ? 'warning-marker' : 'suggestion-marker';
                
                const marker = editor.markText(from, to, {
                    className: markerClass,
                    title: issue.message
                });
                
                errorMarkers.push(marker);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏:', error);
            }
        }
    </script>
</body>
</html>
